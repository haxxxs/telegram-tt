# Telegram Test Solution - MessageCounter

## Задание

> Подсчет моих сообщений в чатах типа группа и личный чат
>
> Подсчет запускается когда объект чата попадает в область видимости.
>
> При начале подсчета выводим плашку с надписью "Подсчет сообщений". При окончании - число сообщений.
>
> Не обязательно, но желательно: Плашка меняет свою ширину плавно.

## Решение

В рамках тестового задания был разработан компонент `MessageCounter`, который выполняет следующие функции:

1. Отслеживает видимость чата в области просмотра
2. Запускает процесс подсчета сообщений, когда чат становится видимым
3. Отображает плашку "Подсчет сообщений" с анимацией во время обработки
4. После завершения подсчета показывает количество сообщений в формате "X сообщ."
5. Скрывает плашку через 6 секунд после завершения подсчета

### Особенности реализации

- **Подсчет всех сообщений**: Компонент использует API Telegram для загрузки всей истории сообщений, а не только текущей сессии
- **Плавная анимация**: Реализована плавная анимация изменения ширины плашки
- **Устойчивость к ошибкам**: Добавлена обработка ошибок и резервный подсчет по текущим загруженным сообщениям
- **Оптимизация производительности**: Используется проверка isMounted для предотвращения утечек памяти

### Файлы решения

- `MessageCounter.tsx` - основной компонент
- `MessageCounter.module.scss` - стили компонента
- `demo.html` - демонстрационная страница для показа работы компонента
- `Chat-integration.md` - документация по интеграции в Telegram Web
- `README.md` - описание решения

## Технические детали

### Интеграция с API Telegram

Компонент интегрируется с API Telegram через следующие методы:

```tsx
const { loadViewportMessages } = getActions();

loadViewportMessages({
  chatId,
  threadId: MAIN_THREAD_ID,
});

const count = messages
  ? Object.values(messages).filter(
      (message: ApiMessage) => message.senderId === currentUserId
    ).length
  : 0;
```

### Анимации и UI

Для обеспечения плавности изменения ширины плашки используются CSS transitions:

```scss
.messageCounter {
  transition: opacity 0.3s, width 0.3s ease;
  // ...другие стили
}
```

## Исправления по результатам обратной связи

После получения обратной связи были внесены следующие улучшения:

1. **Увеличено время отображения плашки** пока запрос не выполнится плажка "подчет сообщений" будет висеть, а результат выполнения будет активен всегда
2. **Улучшен механизм подсчета сообщений** для учета всех сообщений, а не только загруженных в текущей сессии

## Демонстрация

Для демонстрации работы компонента создан файл `demo.html`, который показывает:

- Процесс запуска подсчета
- Анимацию плашки во время подсчета
- Отображение результата
- Автоматическое скрытие плашки
