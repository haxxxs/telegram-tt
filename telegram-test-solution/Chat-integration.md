# Интеграция компонента MessageCounter в Telegram Web клиент

## Описание компонента

`MessageCounter` - компонент, разработанный для подсчета количества сообщений пользователя в чатах типа группа и личный чат (каналы исключены, т.к. там логика сложнее).

Основные особенности компонента:

- Подсчет запускается когда объект чата попадает в область видимости
- При начале подсчета выводится плашка с надписью "Подсчет сообщений"
- При окончании подсчета отображается число сообщений
- Плашка плавно меняет свою ширину для лучшего UX

## Интеграция в Telegram Web

### 1. Перенос файлов

Для интеграции компонента необходимо добавить файлы:

- Основной компонент: `src/components/left/main/MessageCounter.tsx`
- Стили компонента: `src/components/left/main/MessageCounter.module.scss`

### 2. Импорт и использование в коде чата

```tsx
import MessageCounter from "./MessageCounter";

const ChatComponent = () => {
  return (
    <div className={styles.chat}>
      {/* ...существующий код чата */}

      <MessageCounter chatId={selectedChat.id} isVisible={isInViewport} />

      {/* ...остальной код чата */}
    </div>
  );
};
```

### 3. Интеграция с API Telegram

Компонент автоматически подключается к API Telegram для загрузки и подсчета сообщений. Он использует:

- `loadViewportMessages` - для загрузки сообщений из чата
- `withGlobal` - для доступа к глобальному состоянию Telegram клиента
- API методы для доступа к сообщениям и информации о чате

## Логика работы

1. Когда чат становится видимым (попадает в область видимости), компонент переходит в состояние `isCounting` и отображает плашку "Подсчет сообщений"
2. После небольшой задержки (для анимации) компонент запрашивает сообщения через API Telegram
3. Компонент фильтрует полученные сообщения и считает только те, которые принадлежат текущему пользователю
4. После подсчета компонент отображает результат в формате "X сообщ."

## Внесенные изменения

В ходе реализации и по итогам обратной связи были внесены следующие улучшения:

1. **Улучшен механизм подсчета сообщений**:

   - Теперь учитываются все сообщения, а не только загруженные в текущей сессии
   - Используется метод `loadViewportMessages` для загрузки истории сообщений

## Возможные улучшения

В будущем компонент можно усовершенствовать:

1. Добавить анализ общего количества сообщений в чате и отображение процентного соотношения
2. Реализовать более детальную статистику (количество символов, медиа-файлов и т.д.)
3. Добавить возможность перехода к своему первому сообщению в чате
